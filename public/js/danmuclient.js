var socket=io();function initElementSize(){if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}$("section.ui-placehold-wrap").css("height",winWidth*0.4)}function getarray(obj){var arr={};x=obj.serializeArray();$.each(x,function(i,field){arr[field.name]=field.value});return arr}$(function(){initElementSize();$("#submit").click(function(){socket.emit("updanmu",getarray($("#form")));$("#msgsuccess").fadeIn();setTimeout(function(){$("#msgsuccess").fadeOut()},2000);return false});socket.on("broadcastdanmu",function(msg){console.log("get danmu"+msg)});$("#danmu").danmu({left:0,top:30,height:winWidth*0.4,width:winWidth,zindex:100,speed:20000,sumtime:60*60*10,default_font_color:"#000000",font_size_small:30,font_size_big:36,opacity:"0.9",top_botton_danmu_time:6000});$("#danmu").danmu("danmu_start");var a_danmu={"text":"欢迎使用弹幕系统 - by 复旦附中青浦分校程序社","color":"orange","size":"1","position":"0","time":10};$("#danmu").danmu("add_danmu",a_danmu);socket.on("broadcastdanmu",function(msg){console.log("get danmu"+msg);msg["time"]=$("#danmu").data("nowtime");$("#danmu").danmu("add_danmu",msg)})});